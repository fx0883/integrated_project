# 用户系统拆分概述

## 背景与需求

当前系统使用单一的`User`模型处理所有类型的用户，包括超级管理员、租户管理员和普通成员（包括父子账号）。需要将用户系统拆分为两个不同的模型：

1. **User模型**：只包含超级管理员和租户管理员，没有父子账号关系
2. **Member模型**：只包含普通成员，保留父子账号关系

## 当前系统分析

### 现有User模型特点

- 继承自Django的`AbstractUser`
- 包含租户关联(`tenant`)
- 包含父子账号关系(`parent`)
- 使用布尔标志区分角色：`is_admin`、`is_member`、`is_super_admin`
- 包含用户基本信息：手机号、邮箱、昵称、头像等
- 实现了软删除机制
- 重写了`save`方法处理特殊逻辑（配额检查、角色限制等）

### 现有用户系统功能

1. **认证功能**：登录、注册、令牌刷新、密码修改等
2. **用户管理**：创建、查询、更新、删除用户
3. **角色管理**：超级管理员、租户管理员、普通成员的权限控制
4. **子账号管理**：创建和管理子账号

## 拆分方案概览

### 方案选择

有两种主要方案可供选择：

1. **共享基类方案**：创建一个抽象基类，User和Member模型继承该基类
2. **完全分离方案**：User和Member模型分别继承Django的AbstractUser

经过分析，推荐采用**共享基类方案**，原因如下：
- 减少代码重复
- 统一认证机制
- 简化权限控制
- 便于未来扩展

### 系统架构图

```
                    ┌───────────────────┐
                    │   AbstractBaseUser  │
                    │    (Django内置)    │
                    └──────────┬────────┘
                               │
                    ┌──────────┴────────┐
                    │   AbstractUser    │
                    │    (Django内置)   │
                    └──────────┬────────┘
                               │
                    ┌──────────┴────────┐
                    │   BaseUserModel   │
                    │    (抽象基类)     │
                    └─────┬──────┬──────┘
                          │      │
              ┌───────────┘      └───────────┐
              │                              │
    ┌─────────┴─────────┐        ┌──────────┴─────────┐
    │      User         │        │      Member        │
    │ (管理员用户模型)   │        │  (普通成员模型)    │
    └───────────────────┘        └────────────────────┘
```

### 主要变更点

1. **模型拆分**：创建BaseUserModel、User和Member模型
2. **认证系统适配**：修改认证系统以支持两种用户模型
3. **API调整**：分离User和Member的API端点
4. **权限控制**：调整权限检查机制
5. **数据迁移**：将现有数据迁移到新模型

## 后续文档

- [模型设计](model_design.md)：详细的模型结构设计
- [认证系统设计](auth_design.md)：认证系统适配方案
- [API设计](api_design.md)：API端点调整方案
- [数据迁移方案](migration_plan.md)：数据迁移步骤和注意事项 