# 菜单管理系统 - 数据结构文档

## 概述

菜单管理系统用于控制用户的导航菜单显示。系统允许超级管理员为不同用户分配不同的菜单项，实现细粒度的功能访问控制。

## 数据模型

### 1. 菜单模型 (Menu)

菜单项是系统中的基本单位，代表用户界面中的一个导航项。

**核心属性**:
- 主键ID：唯一标识符
- 名称：显示在界面上的菜单名称
- 代码：系统内部使用的唯一标识
- 图标：菜单项显示的图标
- 路径：前端路由路径
- 组件：前端组件路径
- 排序：菜单显示顺序
- 父级菜单ID：指向父菜单，形成树形结构
- 激活状态：控制菜单是否可用
- 时间戳：创建和更新时间
- 备注：可选的说明文本

**索引**:
- 主键: ID
- 唯一索引: 代码
- 外键: 父级菜单ID → 菜单ID（自关联）

### 2. 用户菜单关联模型 (UserMenu)

定义用户与菜单的多对多关系，决定哪些用户可以访问哪些菜单。

**核心属性**:
- 主键ID：唯一标识符
- 用户ID：关联到用户表
- 菜单ID：关联到菜单表
- 激活状态：控制关联是否生效
- 时间戳：创建和更新时间

**索引**:
- 主键: ID
- 复合唯一索引: (用户ID, 菜单ID)
- 外键: 用户ID → 用户.ID
- 外键: 菜单ID → 菜单.ID

## 数据关系图

下图展示了用户、菜单和用户菜单关联之间的关系：

```
┌───────────────────┐           ┌─────────────────────────┐           ┌───────────────────┐
│                   │           │                         │           │                   │
│       用户        │◄────────┤      用户菜单关联       ├─────────►│       菜单        │
│    (User)         │     1:N    │     (UserMenu)         │    N:1    │     (Menu)        │
│                   │           │                         │           │                   │
└───────────────────┘           └─────────────────────────┘           └─────┬─────────────┘
                                                                           │
                                                                           │ 父子关系
                                                                           │ (1:N)
                                                                           ▼
                                                                  ┌───────────────────┐
                                                                  │                   │
                                                                  │       菜单        │
                                                                  │     (Menu)        │
                                                                  │                   │
                                                                  └───────────────────┘
```

## 菜单树形结构

菜单系统采用树形结构组织，允许无限层级的菜单嵌套：

```
┌─ 顶级菜单1
│  ├─ 子菜单1.1
│  │  ├─ 子菜单1.1.1
│  │  └─ 子菜单1.1.2
│  └─ 子菜单1.2
├─ 顶级菜单2
│  ├─ 子菜单2.1
│  └─ 子菜单2.2
└─ 顶级菜单3
   └─ 子菜单3.1
```

## 约束与规则

### 1. 树形结构约束

下图展示了菜单树形结构的约束规则：

```
      ┌────────┐          ┌────────┐
      │ 菜单A  │────────►│ 菜单B  │
      └────────┘  父子关系 └────────┘
          ▲                  │
          │                  │
          │                  │
          └──────────────────┘
              ✗ 循环引用

  ┌─────────┐         ┌─────────┐         ┌─────────┐
  │ 菜单C   │────────►│ 菜单D   │────────►│ 菜单E   │
  └─────────┘         └─────────┘         └─────────┘
                          │
                          ▼
                     ┌─────────┐         
                     │ 菜单F   │         
                     └─────────┘         
```

- 每个菜单项只能有一个父菜单或者无父菜单（顶级菜单）
- 必须避免循环引用（如上图所示的错误情况）
- 菜单删除时，其子菜单也应被删除或调整父级

### 2. 唯一性约束

- 菜单的代码必须全局唯一，作为系统内部标识
- 同一用户下不能重复分配相同的菜单

### 3. 激活状态规则

下图展示了菜单激活状态的继承关系：

```
      ┌─────────────────┐
      │     菜单G       │
      │  (非激活状态)    │
      └─────────────────┘
              │
              ▼
┌─────────────────────────────────┐
│           菜单H                 │
│  (继承非激活状态，UI中不显示)    │
└─────────────────────────────────┘
```

- 菜单被设置为非激活状态时，其所有子菜单在UI中也应视为非激活
- 用户与菜单的关联被设置为非激活状态时，该用户将看不到此菜单

## 数据初始化

系统预设一组基础菜单，类似下图结构：

```
┌─ 仪表盘
├─ 用户管理
│  ├─ 用户列表
│  └─ 角色权限
├─ CMS管理
│  ├─ 内容列表
│  ├─ 分类管理
│  └─ 标签管理
└─ 系统设置
   ├─ 基础设置
   ├─ 菜单设置
   └─ 日志管理
```

这些初始菜单会在系统安装时通过迁移脚本创建。超级管理员可以根据需要扩展或修改这些菜单项。

## 数据维护注意事项

### 1. 菜单编码规范

推荐的菜单编码层次结构：

```
user_management
  ├─ user_management_list
  ├─ user_management_create
  └─ user_management_roles
```

- 建议使用下划线命名法
- 子菜单代码继承父菜单前缀，便于识别和管理

### 2. 图标与路径规范

- 图标：支持字体图标库标识符或自定义图标路径
- 路径：与前端路由系统保持一致，推荐使用 RESTful 风格 